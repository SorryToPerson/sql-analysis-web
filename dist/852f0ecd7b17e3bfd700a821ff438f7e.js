ace.define("ace/ext/beautify",["require","exports","module","ace/token_iterator"],function(S,c,z){"use strict";var _=S("../token_iterator").TokenIterator;function f(m,y){return m.type.lastIndexOf(y+".xml")>-1}c.singletonTags=["area","base","br","col","command","embed","hr","html","img","input","keygen","link","meta","param","source","track","wbr"],c.blockTags=["article","aside","blockquote","body","div","dl","fieldset","footer","form","head","header","html","nav","ol","p","script","section","style","table","tbody","tfoot","thead","ul"],c.formatOptions={lineBreaksAfterCommasInCurlyBlock:!0},c.beautify=function(m){for(var y=new _(m,0,0),t=y.getCurrentToken(),j=m.getTabString(),F=c.singletonTags,D=c.blockTags,K=c.formatOptions||{},s,p=!1,l=!1,d=!1,a="",e="",q="",r=0,B=0,L=0,u=0,h=0,g=0,A=0,x,C=0,i=0,V=[],E=!1,n,w=!1,R=!1,I=!1,v=!1,N={0:0},b=[],O=!1,k=function(){s&&s.value&&s.type!=="string.regexp"&&(s.value=s.value.replace(/^\s*/,""))},$=function(){for(var T=a.length-1;!(T==0||a[T]!==" ");)T=T-1;a=a.slice(0,T+1)},o=function(){a=a.trimRight(),p=!1};t!==null;){if(C=y.getCurrentTokenRow(),V=y.$rowTokens,s=y.stepForward(),typeof t!="undefined"){if(e=t.value,h=0,I=q==="style"||m.$modeId==="ace/mode/css",f(t,"tag-open")?(R=!0,s&&(v=D.indexOf(s.value)!==-1),e==="</"&&(v&&!p&&i<1&&i++,I&&(i=1),h=1,v=!1)):f(t,"tag-close")?R=!1:f(t,"comment.start")?v=!0:f(t,"comment.end")&&(v=!1),!R&&!i&&t.type==="paren.rparen"&&t.value.substr(0,1)==="}"&&i++,C!==x&&(i=C,x&&(i-=x)),i){for(o();i>0;i--)a+=`
`;p=!0,!f(t,"comment")&&!t.type.match(/^(comment|string)$/)&&(e=e.trimLeft())}if(e){if(t.type==="keyword"&&e.match(/^(if|else|elseif|for|foreach|while|switch)$/)?(b[r]=e,k(),d=!0,e.match(/^(else|elseif)$/)&&a.match(/\}[\s]*$/)&&(o(),l=!0)):t.type==="paren.lparen"?(k(),e.substr(-1)==="{"&&(d=!0,w=!1,R||(i=1)),e.substr(0,1)==="{"&&(l=!0,a.substr(-1)!=="["&&a.trimRight().substr(-1)==="["?(o(),l=!1):a.trimRight().substr(-1)===")"?o():$())):t.type==="paren.rparen"?(h=1,e.substr(0,1)==="}"&&(b[r-1]==="case"&&h++,a.trimRight().substr(-1)==="{"?o():(l=!0,I&&(i+=2))),e.substr(0,1)==="]"&&a.substr(-1)!=="}"&&a.trimRight().substr(-1)==="}"&&(l=!1,u++,o()),e.substr(0,1)===")"&&a.substr(-1)!=="("&&a.trimRight().substr(-1)==="("&&(l=!1,u++,o()),$()):(t.type==="keyword.operator"||t.type==="keyword")&&e.match(/^(=|==|===|!=|!==|&&|\|\||and|or|xor|\+=|.=|>|>=|<|<=|=>)$/)?(o(),k(),l=!0,d=!0):t.type==="punctuation.operator"&&e===";"?(o(),k(),d=!0,I&&i++):t.type==="punctuation.operator"&&e.match(/^(:|,)$/)?(o(),k(),e.match(/^(,)$/)&&A>0&&g===0&&K.lineBreaksAfterCommasInCurlyBlock?i++:(d=!0,p=!1)):t.type==="support.php_tag"&&e==="?>"&&!p?(o(),l=!0):f(t,"attribute-name")&&a.substr(-1).match(/^\s$/)?l=!0:f(t,"attribute-equals")?($(),k()):f(t,"tag-close")?($(),e==="/>"&&(l=!0)):t.type==="keyword"&&e.match(/^(case|default)$/)&&O&&(h=1),p&&!(t.type.match(/^(comment)$/)&&!e.substr(0,1).match(/^[/#]$/))&&!(t.type.match(/^(string)$/)&&!e.substr(0,1).match(/^['"@]$/))){if(u=L,r>B)for(u++,n=r;n>B;n--)N[n]=u;else r<B&&(u=N[r]);for(B=r,L=u,h&&(u-=h),w&&!g&&(u++,w=!1),n=0;n<u;n++)a+=j}if(t.type==="keyword"&&e.match(/^(case|default)$/)?O===!1&&(b[r]=e,r++,O=!0):t.type==="keyword"&&e.match(/^(break)$/)&&b[r-1]&&b[r-1].match(/^(case|default)$/)&&(r--,O=!1),t.type==="paren.lparen"&&(g+=(e.match(/\(/g)||[]).length,A+=(e.match(/\{/g)||[]).length,r+=e.length),t.type==="keyword"&&e.match(/^(if|else|elseif|for|while)$/)?(w=!0,g=0):!g&&e.trim()&&t.type!=="comment"&&(w=!1),t.type==="paren.rparen")for(g-=(e.match(/\)/g)||[]).length,A-=(e.match(/\}/g)||[]).length,n=0;n<e.length;n++)r--,e.substr(n,1)==="}"&&b[r]==="case"&&r--;t.type=="text"&&(e=e.replace(/\s+$/," ")),l&&!p&&($(),a.substr(-1)!==`
`&&(a+=" ")),a+=e,d&&(a+=" "),p=!1,l=!1,d=!1,(f(t,"tag-close")&&(v||D.indexOf(q)!==-1)||f(t,"doctype")&&e===">")&&(v&&s&&s.value==="</"?i=-1:i=1),s&&F.indexOf(s.value)===-1&&(f(t,"tag-open")&&e==="</"?r--:f(t,"tag-open")&&e==="<"?r++:f(t,"tag-close")&&e==="/>"&&r--),f(t,"tag-name")&&(q=e),x=C}}t=s}a=a.trim(),m.doc.setValue(a)},c.commands=[{name:"beautify",description:"Format selection (Beautify)",exec:function(m){c.beautify(m.session)},bindKey:"Ctrl-Shift-B"}]}),function(){ace.require(["ace/ext/beautify"],function(S){typeof module=="object"&&typeof exports=="object"&&module&&(module.exports=S)})}();
